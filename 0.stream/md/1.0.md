# ストリームとは
## コピープログラム
下記のプログラムは"入力された文字をそのまま表示するプログラム"  

<script src="https://gist.github.com/KKimishima/a0493302ca2dc618b705868d90364858.js"></script>

## getchar関数とEOF
文字を読み込むgetchar関数が返すのは、読み込んだ文字である  
ただし、エラーや入力の完了を検出するとEOF(End Of File)を返す  
<stdio.h>内でマクロEOFで負値として整数で定義される

>- EOF
>#define EOF -1 //定数の適宜

## 解説
上記のソースを分解すると下記のソースになる

<script src="https://gist.github.com/KKimishima/b432d14117b1d653fd83f60f5048b771.js"></script>

上記のプログラムを実行するとわかるように  
"getchar"では,"stdin"から対応する対応する正数数値を  
習得して,putcharに引き渡している  
つまり、ストリームから対応する番号をもらって、  
その番号から,紐付けされた番号を出力していることがわかる  

## ストリームバッファリング
文字コピーは,一文字読み込むたびに行われるはずだが,
実際は、リターンキーが押された後に一行分まとめてコピーが行わる  
この動作は,以下にして実現知ているのか  

もし、一文字単位でディスクに書き込んでいたら、  
実行速度とディスク負荷が良くないので,  
指定の文字単位でまとめて出力すれば上記の問題を解決できる  

そこで,読み込んだ文字や書き込む文字を,  
いったん"バッファ"を備えてバルブをロックしておく  
下記の規約にしてロックを解除して、OSに対して入出力の要求を行う

  - バッファに一定量が溜まったら
  - プログラム側の都合で即座に読み書きする必要が生じた

このような円滑な出力を実現する手法がバッファリング  
なお、キーバードやディスプレイなどの周辺機器と結びついて、  
"文字が流れる通り道"となっていることを"スリーム"と呼ぶ

## バッファリングの種類
C言語でサポートされているバッファリングは、下記の三種類がある  

- 完全バッファリング(fully buffering)  
  - 入力ストリームからの入力  
    入力された文字はバッファに蓄えられ  
    バッファがいっぱいになった時にホストに転送が送られる  
  - 出力ストリームへの出力  
    出力される文字はバッファに蓄えられ  
    バッファがいっぱいになったときホストに転送される  
- 行バッファリング(line buffering)  
  - 入力ストリームからの入力  
  入力される文字はバッファに蓄えられ  
  改行文字を読み取るか,バッファが満杯になったとき  
  ホスト環境から転送が行われる  
  なお、ホスト環境からの文字転送を必要とされる入力要求があった場合にも転送が行われる  
  - 出力ストリームへの出力  
  出力される文字にバッファに蓄えられる  
  改行文字を書き込むか、バッファがいっぱいになったとき,ホストに転送される  
- 非バッファリング
  - バッファリングを行わない  

## setvbuf関数,setbuf関数:バッファリング方法の変更
バッファリングの方法を変更を行ったり,プログラム側の用意した配列などの領域を  
バッファとしてストリームに結ぶつけたりするためのライブラムが提供されている  

ただし、キーバードやキーボード画面に割当されている標準ストリームに対して、  
これら、関数によってバッファリングの指示をしても,失敗することがある  

## fflush関数:バッファのフラッシュ
バッファ上にたまっている未出力の文字を強制的にフラッシュ(吐きだす)動きをする  
多くの処理系では、標準出力ストリーム用バッファのバルブは普段閉じられており  
以下の条件が成立する時開く  

- 改行文字がバッファ内に入った  
- バッファがいっぱいになった

そのため,バッファ上に蓄えられている文字を強制的に画面に出力させるためには  
fflushにようって,バルブを開く必要がある  

## 標準ストリーム
- stdin:標準入力ストリーム  
  通常の入力を読み取るためのストリームです  
  殆どの環境では,キーボードに割り当てられる  
  scanf関数,getchar関数は、ストリームから入力を行う  
- stdout:標準出力ストリーム  
  通常の出力を書き出すためのストリーム  
  コンソール画面に割り当てられる  
  printf関数,putchar関数は、このストリームに割当られる  
- stderr:標準エラーストリーム  
  エラを書き出すストリーム  
  殆どの環境では,コンソール画面に割り当てられる   
  標準エラーでは,出力を行う場合,printf関数やputcharではなく,  
  fprintf関数,fputを使う  




